<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Movie Player</title>
</head>
<body>
    <div id="player-container">
        <!-- The player iframe will be loaded here -->
    </div>
    <div id="buttons">
        <button data-source="videocdn">Videocdn</button>
        <button data-source="alloha">Alloha</button>
        <button data-source="kodik">Kodik</button>
    </div>

    <script">
    // Function to get the query parameter by name
function getQueryParam(param) {
    const urlParams = new URLSearchParams(window.location.search);
    return urlParams.get(param);
}

// Function to load the player
function loadPlayer(source) {
    const playerContainer = document.getElementById('player-container');

    // Extracting the relevant parameters from the URL
    const kpId = getQueryParam('kp_id');
    const imdb = getQueryParam('imdb');
    const tmdb = getQueryParam('tmdb');
    const title = getQueryParam('title');

    let apiUrl = 'https://kinobox.tv/api/players?';

    // Constructing the API URL based on available query parameters
    if (kpId) {
        apiUrl += `kinopoisk=${kpId}`;
    } else if (imdb) {
        apiUrl += `imdb=${imdb}`;
    } else if (tmdb) {
        apiUrl += `tmdb=${tmdb}`;
    } else if (title) {
        apiUrl += `title=${title}`;
    }

    apiUrl += `&sources=${source}`;

    // Fetch the player URL from the API
    fetch(apiUrl)
        .then(response => response.json())
        .then(data => {
            // Assuming the API returns an iframe URL under the key 'iframeUrl'
            const iframeUrl = data.iframeUrl; // Replace 'iframeUrl' with the correct field name

            if (iframeUrl) {
                // Create or update the iframe
                let iframe = document.getElementById('player-iframe');
                if (!iframe) {
                    iframe = document.createElement('iframe');
                    iframe.id = 'player-iframe';
                    iframe.width = '100%';
                    iframe.height = '500px'; // Adjust height as needed
                    iframe.allowFullscreen = true;
                    playerContainer.appendChild(iframe);
                }
                iframe.src = iframeUrl;
            } else {
                playerContainer.innerHTML = '<p>Player not available. Please try another source.</p>';
            }
        })
        .catch(error => {
            console.error('Error fetching player:', error);
            playerContainer.innerHTML = '<p>Error loading player. Please try again later.</p>';
        });
}

// Function to handle button clicks
function setupButtonClicks() {
    const buttons = document.querySelectorAll('#buttons button');
    buttons.forEach(button => {
        button.addEventListener('click', () => {
            const source = button.getAttribute('data-source');
            loadPlayer(source);
        });
    });
}

// Initialize button click handlers and load default player on page load
window.onload = () => {
    setupButtonClicks();
    loadPlayer('videocdn');
};

    </script>
</body>
</html>
